
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.4">
    
    
      
        <title>Node Groups - Amazon EKS Blueprints for Terraform</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.bde7dde4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ef6f36e2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#node-groups" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Amazon EKS Blueprints for Terraform" class="md-header__button md-logo" aria-label="Amazon EKS Blueprints for Terraform" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Amazon EKS Blueprints for Terraform
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Node Groups
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/aws-ia/terraform-aws-eks-blueprints/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    aws-ia/terraform-aws-eks-blueprints
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Amazon EKS Blueprints for Terraform" class="md-nav__button md-logo" aria-label="Amazon EKS Blueprints for Terraform" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Amazon EKS Blueprints for Terraform
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/aws-ia/terraform-aws-eks-blueprints/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    aws-ia/terraform-aws-eks-blueprints
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../core-concepts/" class="md-nav__link">
        Core Concepts
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Node Groups
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Node Groups
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#managed-node-groups" class="md-nav__link">
    Managed Node Groups
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#self-managed-node-groups" class="md-nav__link">
    Self-managed Node Groups
  </a>
  
    <nav class="md-nav" aria-label="Self-managed Node Groups">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fargate-profile" class="md-nav__link">
    Fargate Profile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-self-managed-node-groups" class="md-nav__link">
    Windows Self-Managed Node Groups
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../teams/" class="md-nav__link">
        Teams
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      <label class="md-nav__link" for="__nav_6">
        Modules
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Modules" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Modules
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../modules/emr-on-eks/" class="md-nav__link">
        EMR on EKS
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      <label class="md-nav__link" for="__nav_7">
        Add-ons
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Add-ons" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Add-ons
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../add-ons/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../add-ons/agones/" class="md-nav__link">
        Agones
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../add-ons/managed-add-ons/" class="md-nav__link">
        Amazon EKS Add-ons
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../add-ons/argocd/" class="md-nav__link">
        Argo CD
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../add-ons/aws-for-fluent-bit/" class="md-nav__link">
        AWS for Fluent Bit
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../add-ons/aws-load-balancer-controller/" class="md-nav__link">
        AWS Load Balancer Controller
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../add-ons/aws-open-telemetry.md" class="md-nav__link">
        AWS Distro for OpenTelemetry
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../add-ons/aws-node-termination-handler/" class="md-nav__link">
        AWS Node Termination Handler
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../add-ons/cert-manager/" class="md-nav__link">
        cert-manager
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../add-ons/cluster-autoscaler/" class="md-nav__link">
        Cluster Autoscaler
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../add-ons/fargate-fluent-bit/" class="md-nav__link">
        Fargate Fluent Bit
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../add-ons/karpenter/" class="md-nav__link">
        Karpenter
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../add-ons/keda/" class="md-nav__link">
        KEDA
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../add-ons/metrics-server/" class="md-nav__link">
        Metrics Server
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../add-ons/nginx/" class="md-nav__link">
        Nginx
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../add-ons/prometheus/" class="md-nav__link">
        Prometheus
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../add-ons/spark-on-k8s-operator/" class="md-nav__link">
        Spark K8S Operator
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../add-ons/tetrate-istio/" class="md-nav__link">
        Tetrate Istio
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../add-ons/traefik/" class="md-nav__link">
        Traefik
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../add-ons/vpa/" class="md-nav__link">
        VPA
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../add-ons/yunikorn/" class="md-nav__link">
        YuniKorn
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      <label class="md-nav__link" for="__nav_8">
        Advanced
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Advanced" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Advanced
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/bottlerocket/" class="md-nav__link">
        Bottlerocket
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/cluster-upgrades/" class="md-nav__link">
        Cluster Upgrades
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/ecr-instructions/" class="md-nav__link">
        ECR Instructions
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/gitops-with-flux/" class="md-nav__link">
        GitOps with Flux
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/multi-cluster/" class="md-nav__link">
        Multi-cluster
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/private-clusters/" class="md-nav__link">
        Private Clusters
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#managed-node-groups" class="md-nav__link">
    Managed Node Groups
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#self-managed-node-groups" class="md-nav__link">
    Self-managed Node Groups
  </a>
  
    <nav class="md-nav" aria-label="Self-managed Node Groups">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fargate-profile" class="md-nav__link">
    Fargate Profile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-self-managed-node-groups" class="md-nav__link">
    Windows Self-Managed Node Groups
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/aws-ia/terraform-aws-eks-blueprints/edit/master/docs/node-groups.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="node-groups">Node Groups<a class="headerlink" href="#node-groups" title="Permanent link">&para;</a></h1>
<p>The framework uses dedicated sub modules for creating <a href="https://github.com/aws-ia/terraform-aws-eks-blueprints/tree/main/modules/aws-eks-managed-node-groups">AWS Managed Node Groups</a>, <a href="https://github.com/aws-ia/terraform-aws-eks-blueprints/tree/main/modules/aws-eks-self-managed-node-groups">Self-managed Node groups</a> and <a href="https://github.com/aws-ia/terraform-aws-eks-blueprints/tree/main/modules/aws-eks-fargate-profiles">Fargate profiles</a>. These modules provide flexibility to add or remove managed/self-managed node groups/fargate profiles by simply adding/removing map of values to input config. See <a href="https://github.com/aws-ia/terraform-aws-eks-blueprints/tree/main/examples/eks-cluster-with-new-vpc">example</a>.</p>
<p>The <code>aws-auth</code> ConfigMap handled by this module allow your nodes to join your cluster, and you also use this ConfigMap to add RBAC access to IAM users and roles.
Each Node Group can have dedicated IAM role, Launch template and Security Group to improve the security.</p>
<h2 id="managed-node-groups">Managed Node Groups<a class="headerlink" href="#managed-node-groups" title="Permanent link">&para;</a></h2>
<p>The below example demonstrates the minimum configuration required to deploy a managed node group.</p>
<div class="highlight"><pre><span></span><code>    # EKS MANAGED NODE GROUPS
    managed_node_groups = {
      mg_4 = {
        node_group_name = &quot;managed-ondemand&quot;
        instance_types  = [&quot;m4.large&quot;]
        subnet_ids      = [] # Mandatory Public or Private Subnet IDs
      }
    }
</code></pre></div>
<p>The below example demonstrates advanced configuration options for a managed node group.</p>
<div class="highlight"><pre><span></span><code>    managed_node_groups = {
      mg_m4 = {
        # 1&gt; Node Group configuration
        node_group_name        = &quot;managed-ondemand&quot;
        create_launch_template = true              # false will use the default launch template
        launch_template_os     = &quot;amazonlinux2eks&quot; # amazonlinux2eks or windows or bottlerocket
        public_ip              = false             # Use this to enable public IP for EC2 instances; only for public subnets used in launch templates ;
        pre_userdata           = &lt;&lt;-EOT
                    yum install -y amazon-ssm-agent
                    systemctl enable amazon-ssm-agent &amp;&amp; systemctl start amazon-ssm-agent&quot;
                EOT
        # 2&gt; Node Group scaling configuration
        desired_size    = 3
        max_size        = 3
        min_size        = 3
        max_unavailable = 1 # or percentage = 20

        # 3&gt; Node Group compute configuration
        ami_type       = &quot;AL2_x86_64&quot; # Amazon Linux 2(AL2_x86_64), AL2_x86_64_GPU, AL2_ARM_64, BOTTLEROCKET_x86_64, BOTTLEROCKET_ARM_64
        capacity_type  = &quot;ON_DEMAND&quot;  # ON_DEMAND or SPOT
        instance_types = [&quot;m4.large&quot;] # List of instances used only for SPOT type
        disk_size      = 50

        # 4&gt; Node Group network configuration
        subnet_ids = [] # Mandatory - # Define private/public subnets list with comma separated [&quot;subnet1&quot;,&quot;subnet2&quot;,&quot;subnet3&quot;]
        k8s_taints = []
        # optionally, configure a taint on the node group:
        # k8s_taints = [{key= &quot;purpose&quot;, value=&quot;execution&quot;, &quot;effect&quot;=&quot;NO_SCHEDULE&quot;}]
        k8s_labels = {
          Environment = &quot;preprod&quot;
          Zone        = &quot;dev&quot;
          WorkerType  = &quot;ON_DEMAND&quot;
        }
        additional_tags = {
          ExtraTag    = &quot;m4-on-demand&quot;
          Name        = &quot;m4-on-demand&quot;
          subnet_type = &quot;private&quot;
        }
      }
    }
</code></pre></div>
<h2 id="self-managed-node-groups">Self-managed Node Groups<a class="headerlink" href="#self-managed-node-groups" title="Permanent link">&para;</a></h2>
<p>The below example demonstrates the minimum configuration required to deploy a Self-managed node group.</p>
<div class="highlight"><pre><span></span><code>    # EKS SELF MANAGED NODE GROUPS
    self_managed_node_groups = {
        self_mg_4 = {
          node_group_name    = &quot;self-managed-ondemand&quot;
          launch_template_os = &quot;amazonlinux2eks&quot;
          subnet_ids         = module.aws_vpc.private_subnets
        }
    }
</code></pre></div>
<p>The below example demonstrates advanced configuration options for a self-managed node group.</p>
<div class="highlight"><pre><span></span><code>    self_managed_node_groups = {
      self_mg_4 = {
        node_group_name      = &quot;self-managed-ondemand&quot;
        instance_type        = &quot;m5.large&quot;
        custom_ami_id        = &quot;ami-0dfaa019a300f219c&quot; # Bring your own custom AMI generated by Packer/ImageBuilder/Puppet etc.
        capacity_type        = &quot;&quot;                      # Optional Use this only for SPOT capacity as capacity_type = &quot;spot&quot;
        launch_template_os   = &quot;amazonlinux2eks&quot;       # amazonlinux2eks  or bottlerocket or windows
        pre_userdata         = &lt;&lt;-EOT
            yum install -y amazon-ssm-agent \
            systemctl enable amazon-ssm-agent &amp;&amp; systemctl start amazon-ssm-agent \
        EOT
        post_userdata        = &quot;&quot;
        kubelet_extra_args   = &quot;&quot;
        bootstrap_extra_args = &quot;&quot;
        block_device_mapping = [
          {
            device_name = &quot;/dev/xvda&quot; # mount point to /
            volume_type = &quot;gp3&quot;
            volume_size = 20
          },
          {
            device_name = &quot;/dev/xvdf&quot; # mount point to /local1 (it could be local2, depending upon the disks are attached during boot)
            volume_type = &quot;gp3&quot;
            volume_size = 50
            iops        = 3000
            throughput  = 125
          },
          {
            device_name = &quot;/dev/xvdg&quot; # mount point to /local2 (it could be local1, depending upon the disks are attached during boot)
            volume_type = &quot;gp3&quot;
            volume_size = 100
            iops        = 3000
            throughput  = 125
          }
        ]
        enable_monitoring = false
        public_ip         = false # Enable only for public subnets
        # AUTOSCALING
        max_size   = &quot;3&quot;
        min_size   = &quot;1&quot;
        subnet_ids = [] # Mandatory Public or Private Subnet IDs
        additional_tags = {
          ExtraTag    = &quot;m5x-on-demand&quot;
          Name        = &quot;m5x-on-demand&quot;
          subnet_type = &quot;private&quot;
        }
        additional_iam_policies = []
      },
    }
</code></pre></div>
<p>With the previous described example at <code>block_device_mapping</code>, in case you choose an instance that has local NVMe storage, you will achieve the three specified EBS disks plus all local NVMe disks that instance brings. For example, for an <code>m5d.large</code> you will end up with the following mount points: <code>/</code> for device named <code>/dev/xvda</code>, <code>/local1</code> for device named <code>/dev/xvdf</code>, <code>/local2</code> for device named <code>/dev/xvdg</code>, and <code>/local3</code> for instance storage (in such case a disk with 70GB).</p>
<p>Check the following references as you may desire:</p>
<ul>
<li><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/nvme-ebs-volumes.html">Amazon EBS and NVMe on Linux instances</a>.</li>
<li><a href="https://docs.aws.amazon.com/AWSEC2/latest/WindowsGuide/aws-nvme-drivers.html">AWS NVMe drivers for Windows instances</a></li>
<li><a href="https://aws.amazon.com/blogs/aws/ec2-instance-update-m5-instances-with-local-nvme-storage-m5d/">EC2 Instance Update – M5 Instances with Local NVMe Storage (M5d)</a></li>
</ul>
<h3 id="fargate-profile">Fargate Profile<a class="headerlink" href="#fargate-profile" title="Permanent link">&para;</a></h3>
<p>The example below demonstrates how you can customize a Fargate profile for your cluster.</p>
<div class="highlight"><pre><span></span><code>    fargate_profiles = {
      default = {
        fargate_profile_name = &quot;default&quot;
        fargate_profile_namespaces = [{
          namespace = &quot;default&quot;
          k8s_labels = {
            Environment = &quot;preprod&quot;
            Zone        = &quot;dev&quot;
            env         = &quot;fargate&quot;
          }
        }]

        subnet_ids = [] # Mandatory - # Define private subnets list with comma separated [&quot;subnet1&quot;,&quot;subnet2&quot;,&quot;subnet3&quot;]

        additional_tags = {
          ExtraTag = &quot;Fargate&quot;
        }
      }
    }
</code></pre></div>
<h3 id="windows-self-managed-node-groups">Windows Self-Managed Node Groups<a class="headerlink" href="#windows-self-managed-node-groups" title="Permanent link">&para;</a></h3>
<p>The example below demonstrates the minimum configuration required to deploy a Self-managed node group of Windows nodes. Refer to the <a href="https://docs.aws.amazon.com/eks/latest/userguide/windows-support.html">AWS EKS user guide</a> for more information about Windows support in EKS.</p>
<div class="highlight"><pre><span></span><code>  # SELF-MANAGED NODE GROUP with Windows support
  enable_windows_support = true

  self_managed_node_groups = {
    ng_od_windows = {
      node_group_name    = &quot;ng-od-windows&quot;
      launch_template_os = &quot;windows&quot;
      instance_type      = &quot;m5n.large&quot;
      subnet_ids         = module.aws_vpc.private_subnets
      min_size           = &quot;2&quot;
    }
  }
</code></pre></div>
<p>In clusters where Windows support is enabled, workloads should have explicit node assignments configured using <code>nodeSelector</code> or <code>affinity</code>, as described in the Kubernetes document <a href="https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/">Assigning Pods to Nodes</a>.
For example, if you are enabling the <code>metrics-server</code> Kubernetes add-on (Helm chart), use the following configuration to ensure its pods are assigned to Linux nodes. See the <a href="../examples/node-groups/windows-node-groups/">EKS Cluster with Windows Support example</a> for full Terraform configuration and workload deployment samples.</p>
<div class="highlight"><pre><span></span><code>  enable_metrics_server = true
  metrics_server_helm_config = {
    set = [
      {
        name  = &quot;nodeSelector.kubernetes\\.io/os&quot;
        value = &quot;linux&quot;
      }
    ]
  }
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../core-concepts/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Core Concepts
            </div>
          </div>
        </a>
      
      
        <a href="../teams/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Teams
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["tabs"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../assets/javascripts/workers/search.4fa0e4ee.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.1d3bfcf1.min.js"></script>
      
    
  </body>
</html>